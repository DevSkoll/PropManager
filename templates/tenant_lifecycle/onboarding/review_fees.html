{% extends "tenant_lifecycle/onboarding/base.html" %}

{% block title %}Review Move-In Fees{% endblock %}

{% block content %}
<div class="onboarding-card">
    <div class="onboarding-card-header">
        <h2 class="h4 mb-1">
            <i class="bi bi-receipt me-2 text-primary"></i>
            {{ step_name }}
        </h2>
        <p class="text-muted mb-0">Review the fees due upon move-in</p>
    </div>

    <div class="onboarding-card-body">
        <div class="alert alert-info mb-4">
            <i class="bi bi-info-circle me-2"></i>
            <strong>No payment required now.</strong>
            These fees will be invoiced after you complete the onboarding process.
        </div>

        {% if fees %}
        <div class="mb-4">
            <h6 class="text-muted mb-3">Move-In Fees</h6>

            {% for fee in fees %}
            <div class="d-flex justify-content-between align-items-center py-3 border-bottom">
                <div>
                    <strong>{{ fee.name }}</strong>
                    {% if fee.description %}
                    <br><small class="text-muted">{{ fee.description }}</small>
                    {% endif %}
                    {% if fee.is_refundable %}
                    <span class="badge bg-secondary ms-2">Refundable</span>
                    {% endif %}
                </div>
                <strong class="text-nowrap">${{ fee.amount|floatformat:2 }}</strong>
            </div>
            {% endfor %}

            <div class="bg-light rounded p-3 mt-4">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Total Due at Move-In</h5>
                    <h4 class="mb-0 text-primary">${{ total_due|floatformat:2 }}</h4>
                </div>
            </div>
        </div>
        {% else %}
        <div class="text-center py-4">
            <i class="bi bi-check-circle text-success fs-1"></i>
            <p class="mt-3 text-muted">No move-in fees required for your lease.</p>
        </div>
        {% endif %}

        <form method="post" action="{% url 'tenant_lifecycle:onboarding_payments_complete' token=session.access_token %}">
            {% csrf_token %}

            {% if fees %}
            <div class="form-check mt-4 p-3 border rounded bg-light">
                <input class="form-check-input" type="checkbox" name="acknowledge_fees" id="acknowledge_fees" value="1" required>
                <label class="form-check-label" for="acknowledge_fees">
                    <strong>I understand and acknowledge</strong> that by completing this onboarding process and signing the lease agreement, I am legally obligated to pay the fees listed above totaling <strong>${{ total_due|floatformat:2 }}</strong> upon or before move-in.
                </label>
            </div>
            {% else %}
            <input type="hidden" name="acknowledge_fees" value="1">
            {% endif %}

            <div class="d-grid mt-4">
                <button type="submit" class="btn btn-onboarding btn-lg">
                    Continue
                    <i class="bi bi-arrow-right ms-2"></i>
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
