# Generated by Django 6.0.2 on 2026-02-20 21:14

import apps.tenant_lifecycle.models
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('billing', '0007_bitcoinpricesnapshot_alter_payment_method_and_more'),
        ('documents', '0004_seed_lease_template'),
        ('leases', '0002_lease_auto_renewal_lease_fully_executed_at_and_more'),
        ('properties', '0002_property_manager_email_property_manager_name_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='OnboardingSession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('prospective_email', models.EmailField(max_length=254)),
                ('prospective_phone', models.CharField(blank=True, max_length=20)),
                ('prospective_first_name', models.CharField(max_length=50)),
                ('prospective_last_name', models.CharField(max_length=50)),
                ('status', models.CharField(choices=[('invited', 'Invited'), ('started', 'Started'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('expired', 'Expired'), ('cancelled', 'Cancelled')], default='invited', max_length=20)),
                ('current_step', models.CharField(default='account_creation', max_length=50)),
                ('steps_completed', models.JSONField(default=dict, help_text='Dict mapping step names to completion timestamps.')),
                ('access_token', models.CharField(default=apps.tenant_lifecycle.models.generate_access_token, max_length=64, unique=True)),
                ('token_expires_at', models.DateTimeField()),
                ('invitation_sent_at', models.DateTimeField(blank=True, null=True)),
                ('first_accessed_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, help_text='Internal notes about this session.')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_onboarding_sessions', to=settings.AUTH_USER_MODEL)),
                ('lease', models.ForeignKey(blank=True, help_text='Linked lease (may be created during onboarding).', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='onboarding_sessions', to='leases.lease')),
                ('tenant', models.ForeignKey(blank=True, help_text='Created user account (populated during account creation step).', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='onboarding_sessions', to=settings.AUTH_USER_MODEL)),
                ('unit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='onboarding_sessions', to='properties.unit')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='OnboardingStepLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('step_name', models.CharField(max_length=50)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('attempt_number', models.PositiveSmallIntegerField(default=1)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('data_snapshot', models.JSONField(default=dict, help_text='Snapshot of submitted data for this step.')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='step_logs', to='tenant_lifecycle.onboardingsession')),
            ],
            options={
                'ordering': ['session', 'started_at'],
            },
        ),
        migrations.CreateModel(
            name='OnboardingTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=100)),
                ('is_active', models.BooleanField(default=True)),
                ('is_default', models.BooleanField(default=False, help_text='If true, this is the default template for this property.')),
                ('steps_config', models.JSONField(default=dict, help_text='Configuration for each onboarding step (enabled, order, required).')),
                ('collect_vehicles', models.BooleanField(default=True)),
                ('collect_employment', models.BooleanField(default=True)),
                ('require_renters_insurance', models.BooleanField(default=False)),
                ('require_id_verification', models.BooleanField(default=False)),
                ('welcome_message', models.TextField(blank=True, help_text='Welcome message displayed at the end of onboarding.')),
                ('property_rules', models.TextField(blank=True, help_text='Property rules and guidelines shown to tenant.')),
                ('move_in_checklist', models.JSONField(default=list, help_text='List of move-in checklist items for the tenant.')),
                ('invitation_email_subject', models.CharField(default='Welcome! Complete Your Move-In Process', max_length=200)),
                ('invitation_email_body', models.TextField(blank=True, help_text='Custom email body for invitation. Use {{link}} for the onboarding URL.')),
                ('invitation_sms_body', models.CharField(blank=True, help_text='SMS message for invitation. Use {{link}} for the URL.', max_length=320)),
                ('link_expiry_days', models.PositiveSmallIntegerField(default=14, help_text='Number of days before onboarding link expires.')),
                ('property', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='onboarding_templates', to='properties.property')),
            ],
            options={
                'ordering': ['property', 'name'],
            },
        ),
        migrations.AddField(
            model_name='onboardingsession',
            name='template',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sessions', to='tenant_lifecycle.onboardingtemplate'),
        ),
        migrations.CreateModel(
            name='OnboardingTemplateDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('order', models.PositiveSmallIntegerField(default=0)),
                ('is_required', models.BooleanField(default=True)),
                ('description', models.CharField(blank=True, help_text='Optional description shown to tenant.', max_length=255)),
                ('edocument_template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='onboarding_usages', to='documents.edocumenttemplate')),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tenant_lifecycle.onboardingtemplate')),
            ],
            options={
                'ordering': ['order'],
            },
        ),
        migrations.CreateModel(
            name='OnboardingDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_required', models.BooleanField(default=True)),
                ('viewed_at', models.DateTimeField(blank=True, null=True)),
                ('signed_at', models.DateTimeField(blank=True, null=True)),
                ('edocument', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='onboarding_records', to='documents.edocument')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='tenant_lifecycle.onboardingsession')),
                ('template_document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='instances', to='tenant_lifecycle.onboardingtemplatedocument')),
            ],
            options={
                'ordering': ['template_document__order'],
            },
        ),
        migrations.CreateModel(
            name='OnboardingTemplateFee',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('fee_type', models.CharField(choices=[('security_deposit', 'Security Deposit'), ('first_month', "First Month's Rent"), ('last_month', "Last Month's Rent"), ('pet_deposit', 'Pet Deposit'), ('pet_fee', 'Pet Fee (Non-Refundable)'), ('admin_fee', 'Administrative Fee'), ('application_fee', 'Application Fee'), ('key_deposit', 'Key Deposit'), ('parking_fee', 'Parking Fee'), ('other', 'Other Fee')], max_length=20)),
                ('name', models.CharField(help_text='Display name for this fee.', max_length=100)),
                ('description', models.CharField(blank=True, max_length=255)),
                ('amount', models.DecimalField(blank=True, decimal_places=2, help_text='Fixed amount. Leave blank to use lease value.', max_digits=10, null=True)),
                ('use_lease_value', models.BooleanField(default=False, help_text='If true, pull amount from lease field.')),
                ('lease_field', models.CharField(blank=True, help_text="Lease field to pull value from (e.g., 'monthly_rent', 'security_deposit').", max_length=50)),
                ('is_required', models.BooleanField(default=True)),
                ('is_refundable', models.BooleanField(default=False)),
                ('order', models.PositiveSmallIntegerField(default=0)),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fees', to='tenant_lifecycle.onboardingtemplate')),
            ],
            options={
                'ordering': ['order'],
            },
        ),
        migrations.CreateModel(
            name='OnboardingPayment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('fee_type', models.CharField(max_length=20)),
                ('description', models.CharField(max_length=255)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('is_refundable', models.BooleanField(default=False)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('refunded', 'Refunded')], default='pending', max_length=20)),
                ('last_error', models.TextField(blank=True)),
                ('attempt_count', models.PositiveSmallIntegerField(default=0)),
                ('invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='onboarding_payments', to='billing.invoice')),
                ('payment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='onboarding_payments', to='billing.payment')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='tenant_lifecycle.onboardingsession')),
                ('template_fee', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payments', to='tenant_lifecycle.onboardingtemplatefee')),
            ],
            options={
                'ordering': ['session', 'template_fee__order'],
            },
        ),
        migrations.CreateModel(
            name='TenantEmployment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employment_type', models.CharField(choices=[('full_time', 'Full-Time Employee'), ('part_time', 'Part-Time Employee'), ('self_employed', 'Self-Employed'), ('contractor', 'Independent Contractor'), ('retired', 'Retired'), ('student', 'Student'), ('unemployed', 'Currently Unemployed'), ('other', 'Other')], max_length=20)),
                ('employer_name', models.CharField(blank=True, max_length=100)),
                ('employer_phone', models.CharField(blank=True, max_length=20)),
                ('employer_address', models.TextField(blank=True)),
                ('job_title', models.CharField(blank=True, max_length=100)),
                ('start_date', models.DateField(blank=True, null=True)),
                ('gross_income', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('income_frequency', models.CharField(choices=[('weekly', 'Weekly'), ('biweekly', 'Bi-Weekly'), ('semimonthly', 'Semi-Monthly'), ('monthly', 'Monthly'), ('annual', 'Annually')], default='monthly', max_length=20)),
                ('additional_income', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('additional_income_source', models.CharField(blank=True, max_length=100)),
                ('is_current', models.BooleanField(default=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('lease', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='employment_records', to='leases.lease')),
                ('onboarding_session', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='employment_records', to='tenant_lifecycle.onboardingsession')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employment_records', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_employments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-is_current', '-start_date'],
            },
        ),
        migrations.CreateModel(
            name='TenantIDVerification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('id_type', models.CharField(choices=[('drivers_license', "Driver's License"), ('state_id', 'State ID'), ('passport', 'Passport'), ('military_id', 'Military ID'), ('other', 'Other Government ID')], max_length=20)),
                ('id_number', models.CharField(blank=True, help_text='Last 4 digits only for security.', max_length=50)),
                ('issuing_state', models.CharField(blank=True, max_length=50)),
                ('expiration_date', models.DateField(blank=True, null=True)),
                ('front_image', models.ImageField(upload_to='id_verification/%Y/%m/')),
                ('back_image', models.ImageField(blank=True, upload_to='id_verification/%Y/%m/')),
                ('status', models.CharField(choices=[('pending', 'Pending Review'), ('approved', 'Approved'), ('rejected', 'Rejected')], default='pending', max_length=20)),
                ('rejection_reason', models.TextField(blank=True)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('onboarding_session', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='id_verifications', to='tenant_lifecycle.onboardingsession')),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reviewed_id_verifications', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='id_verifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TenantInsurance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('provider_name', models.CharField(max_length=100)),
                ('policy_number', models.CharField(max_length=50)),
                ('coverage_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Personal property coverage amount.', max_digits=12, null=True)),
                ('liability_coverage', models.DecimalField(blank=True, decimal_places=2, help_text='Liability coverage amount.', max_digits=12, null=True)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('policy_document', models.FileField(blank=True, upload_to='tenant_insurance/%Y/%m/')),
                ('is_active', models.BooleanField(default=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('lease', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='insurance_policies', to='leases.lease')),
                ('onboarding_session', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='insurance_records', to='tenant_lifecycle.onboardingsession')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='insurance_policies', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_insurance_policies', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Tenant insurance policies',
                'ordering': ['-start_date'],
            },
        ),
        migrations.CreateModel(
            name='TenantVehicle',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('vehicle_type', models.CharField(choices=[('car', 'Car'), ('truck', 'Truck'), ('suv', 'SUV'), ('van', 'Van'), ('motorcycle', 'Motorcycle'), ('rv', 'RV/Motorhome'), ('trailer', 'Trailer'), ('other', 'Other')], default='car', max_length=20)),
                ('make', models.CharField(max_length=50)),
                ('model', models.CharField(max_length=50)),
                ('year', models.PositiveSmallIntegerField(blank=True, null=True)),
                ('color', models.CharField(max_length=30)),
                ('license_plate', models.CharField(max_length=20)),
                ('state', models.CharField(help_text='State/province code.', max_length=2)),
                ('parking_space', models.CharField(blank=True, max_length=20)),
                ('parking_permit_number', models.CharField(blank=True, max_length=50)),
                ('is_primary', models.BooleanField(default=False)),
                ('is_active', models.BooleanField(default=True)),
                ('lease', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vehicles', to='leases.lease')),
                ('onboarding_session', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vehicles', to='tenant_lifecycle.onboardingsession')),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vehicles', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-is_primary', 'make', 'model'],
            },
        ),
        migrations.AddConstraint(
            model_name='onboardingtemplate',
            constraint=models.UniqueConstraint(condition=models.Q(('is_default', True)), fields=('property',), name='unique_default_template_per_property'),
        ),
        migrations.AlterUniqueTogether(
            name='onboardingtemplatedocument',
            unique_together={('template', 'edocument_template')},
        ),
    ]
